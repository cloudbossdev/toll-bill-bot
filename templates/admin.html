{% extends 'base.html' %}

{% block content %}
<section class="admin-header">
  <div>
    <h2>Admin control center</h2>
    <p>Manage subscriber accounts, plans, and credits for fleet tiers.</p>
  </div>
</section>

<section class="admin-layout">
  <article class="admin-form">
    <h3>Create user</h3>
    <form method="post">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <label>Email
        <input type="email" name="email" required>
      </label>
      <label>Password
        <input type="password" name="password" required>
      </label>
      <label>Role
        <select name="role">
          <option value="subscriber">Subscriber</option>
          <option value="admin">Admin</option>
        </select>
      </label>
      <label>Plan
        <select name="plan">
          {% for plan in plans %}
            <option value="{{ plan.name }}">${{ plan.price }} {{ plan.name }}</option>
          {% endfor %}
        </select>
      </label>
      <label>Fleet size
        <input type="number" name="fleet_size" min="1" value="1">
      </label>
      <label>Credits
        <input type="number" name="credits" min="0" value="10">
      </label>
      <button type="submit" class="contrast">Create user</button>
    </form>
  </article>
  <article>
    <h3>Plan pricing</h3>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Plan</th>
            <th>Price (USD)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for plan in plans %}
            <tr>
              <td>{{ plan.name }}</td>
              <td colspan="2">
                <form method="post" action="{{ url_for('admin_update_plan', plan_id=plan.id) }}" class="inline-form admin-actions">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="number" name="price" min="0" value="{{ plan.price }}">
                  <button type="submit" class="secondary" aria-label="Save price">&#10003;</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </article>
  <article class="admin-subscribers">
    <h3>Subscribers</h3>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Email</th>
            <th>Role</th>
            <th>Plan</th>
            <th>Fleet size</th>
            <th>Credits</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
            <form id="user-form-{{ user.id }}" method="post" action="{{ url_for('admin_update_user', user_id=user.id) }}">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            </form>
            <tr>
              <td>
                <input type="email" name="email" value="{{ user.email }}" form="user-form-{{ user.id }}" class="user-field" data-original="{{ user.email }}" disabled>
              </td>
              <td>
                <select name="role" form="user-form-{{ user.id }}" class="user-field" data-original="{{ user.role }}" disabled>
                  <option value="subscriber" {% if user.role == 'subscriber' %}selected{% endif %}>Subscriber</option>
                  <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
                </select>
              </td>
              <td>
                <select name="plan" form="user-form-{{ user.id }}" class="user-field" data-original="{{ user.plan }}" disabled>
                  {% for plan in plans %}
                    <option value="{{ plan.name }}" {% if user.plan == plan.name %}selected{% endif %}>{{ plan.name }}</option>
                  {% endfor %}
                </select>
              </td>
              <td>
                <input type="number" name="fleet_size" min="1" value="{{ user.fleet_size }}" form="user-form-{{ user.id }}" class="user-field" data-original="{{ user.fleet_size }}" disabled>
              </td>
              <td>
                <input type="number" name="credits" min="0" value="{{ user.credits }}" form="user-form-{{ user.id }}" class="user-field" data-original="{{ user.credits }}" disabled>
              </td>
              <td class="admin-actions">
                <button type="button" class="secondary edit-user" data-user-id="{{ user.id }}" aria-label="Edit user">&#9998;</button>
                <button type="submit" form="user-form-{{ user.id }}" class="contrast save-user" data-user-id="{{ user.id }}" aria-label="Save user" hidden>&#10003;</button>
                <button type="button" class="secondary cancel-user" data-user-id="{{ user.id }}" aria-label="Cancel edit" hidden>&#10005;</button>
                <form method="post" action="{{ url_for('admin_delete_user', user_id=user.id) }}" class="inline-form">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button type="submit" class="secondary delete-user" data-user-id="{{ user.id }}" aria-label="Delete user">&#128465;</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </article>
</section>
{% endblock %}
